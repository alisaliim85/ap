{% extends 'base.html' %}

{% block content %}
<div class="max-w-5xl mx-auto">

    <div class="mb-6 flex flex-col md:flex-row md:items-center justify-between gap-4">
        <div>
            <div class="flex items-center gap-3">
                <a href="{% url 'policies:policy_list' %}"
                    class="w-8 h-8 rounded-full bg-white border border-slate-200 flex items-center justify-center text-slate-400 hover:text-brand-600 transition shadow-sm">
                    <i class="ph-bold ph-arrow-right"></i>
                </a>
                <h2 class="text-2xl font-black text-slate-800">تفاصيل البوليصة: {{ policy.policy_number }}</h2>
            </div>
            <p class="text-slate-500 text-sm mt-1 mr-11">بوليصة تابعة لـ {{ policy.client.name_ar }} من خلال {{
                policy.provider.name_ar }}</p>
        </div>
        <div class="flex gap-2">
            <a href="{% url 'policies:policy_update' policy.pk %}"
                class="px-4 py-2 bg-white border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50 font-bold text-sm flex items-center gap-2 transition shadow-sm">
                <i class="ph-duotone ph-pencil-simple text-brand-600 text-lg"></i> تعديل
            </a>
            <a href="{% url 'policies:policy_delete' policy.pk %}"
                class="px-4 py-2 bg-red-50 text-red-600 border border-red-100 rounded-lg hover:bg-red-100 font-bold text-sm flex items-center gap-2 transition shadow-sm">
                <i class="ph-duotone ph-trash text-lg"></i> حذف
            </a>
        </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-4 gap-6">

        <!-- Sidebar Info -->
        <div class="space-y-6">
            <div class="bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden text-center p-6">
                {% if policy.is_active %}
                <div
                    class="w-16 h-16 bg-green-50 text-green-600 rounded-full flex items-center justify-center mx-auto mb-4 border border-green-100 shadow-inner">
                    <i class="ph-duotone ph-check-circle text-3xl"></i>
                </div>
                <span
                    class="text-green-600 text-xs font-black uppercase tracking-widest bg-green-50 px-3 py-1 rounded-full border border-green-100">بوليصة
                    نشطة</span>
                {% else %}
                <div
                    class="w-16 h-16 bg-slate-50 text-slate-400 rounded-full flex items-center justify-center mx-auto mb-4 border border-slate-200 shadow-inner">
                    <i class="ph-duotone ph-x-circle text-3xl"></i>
                </div>
                <span
                    class="text-slate-400 text-xs font-black uppercase tracking-widest bg-slate-50 px-3 py-1 rounded-full border border-slate-200">منتهية
                    الصلاحية</span>
                {% endif %}

                <div class="mt-8 pt-6 border-t border-slate-50 space-y-4">
                    <div class="text-right">
                        <label class="block text-[10px] font-black text-slate-400 uppercase tracking-wider mb-0.5">تبدأ
                            من</label>
                        <p class="text-slate-700 font-bold font-mono">{{ policy.start_date|date:"Y-m-d" }}</p>
                    </div>
                    <div class="text-right">
                        <label class="block text-[10px] font-black text-slate-400 uppercase tracking-wider mb-0.5">تنتهي
                            في</label>
                        <p class="text-slate-700 font-bold font-mono">{{ policy.end_date|date:"Y-m-d" }}</p>
                    </div>
                </div>

                {% if policy.contract_file %}
                <a href="{{ policy.contract_file.url }}" target="_blank"
                    class="mt-8 w-full py-3 bg-brand-600 text-white rounded-lg font-bold text-xs flex items-center justify-center gap-2 shadow-lg shadow-brand-100 hover:bg-brand-700 transition">
                    <i class="ph-bold ph-file-pdf text-lg"></i> عرض ملف العقد
                </a>
                {% endif %}
            </div>

            <div class="bg-indigo-900 rounded-xl p-6 text-white text-center">
                <h4 class="text-xs font-bold uppercase tracking-widest text-indigo-300 mb-6">إحصائيات الفئات</h4>
                <div class="text-4xl font-black mb-1">{{ classes.count }}</div>
                <p class="text-indigo-200 text-[10px] font-medium">فئات تأمينية مضافة</p>
            </div>
        </div>

        <!-- Main Content -->
        <div class="md:col-span-3 space-y-6">

            <div class="bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden">
                <div class="p-6 border-b border-slate-200 bg-slate-50 flex items-center justify-between">
                    <h3 class="font-bold text-slate-800 flex items-center gap-2">
                        <i class="ph-duotone ph-users-three text-brand-600 text-xl"></i>
                        الفئات والشبكات (Policy Classes)
                    </h3>
                    <a href="{% url 'policies:policy_class_create' policy.pk %}"
                        class="px-3 py-1.5 bg-brand-600 text-white rounded-lg hover:bg-brand-700 font-bold text-[10px] transition flex items-center gap-1">
                        <i class="ph-bold ph-plus"></i> إضافة فئة جديدة
                    </a>
                </div>

                <div class="p-4 grid grid-cols-1 sm:grid-cols-2 gap-4">
                    {% for c in classes %}
                    <div
                        class="group bg-slate-50 rounded-xl p-5 border border-slate-200 hover:border-brand-500 hover:bg-white hover:shadow-xl hover:shadow-brand-500/5 transition-all relative overflow-hidden">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h4 class="text-xl font-black text-slate-800">{{ c.name }}</h4>
                                <p class="text-xs text-brand-600 font-bold">{{ c.network.name_en }}</p>
                            </div>
                            <div class="text-left">
                                <span class="block text-[9px] font-black text-slate-400 uppercase">Limit</span>
                                <span class="text-slate-800 font-mono font-black">{{ c.annual_limit|floatformat:0
                                    }}</span>
                                <span class="text-[9px] text-slate-400">SAR</span>
                            </div>
                        </div>

                        <div
                            class="grid grid-cols-2 gap-2 text-[10px] font-bold text-slate-500 mt-6 pt-4 border-t border-slate-100">
                            <a href="{% url 'policies:class_benefit_manage' c.pk %}"
                                class="py-2 bg-white border border-slate-200 rounded-lg text-center hover:bg-brand-50 hover:text-brand-600 transition">إدارة
                                المنافع</a>
                            <a href="#"
                                class="py-2 bg-white border border-slate-200 rounded-lg text-center hover:bg-brand-50 hover:text-brand-600 transition text-slate-400">تعديل
                                الفئة</a>
                        </div>
                        <i
                            class="ph-duotone ph-shield-check absolute -bottom-4 -left-4 text-brand-500/5 text-8xl group-hover:text-brand-500/10 transition-colors"></i>
                    </div>
                    {% empty %}
                    <div class="sm:col-span-2 py-12 text-center text-slate-400">
                        <i class="ph-duotone ph-selection-plus text-5xl mb-2 opacity-30"></i>
                        <p class="text-sm font-bold">لا يوجد فئات مضافة لهذه البوليصة حتى الآن</p>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <div class="bg-slate-50 border-2 border-dashed border-slate-200 rounded-xl p-10 text-center">
                <i class="ph-duotone ph-info text-4xl text-slate-300 mb-2"></i>
                <p class="text-slate-400 text-sm font-medium leading-relaxed">
                    بعد إضافة الفئات، يمكنك تحديد سقف التغطية لكل منفعة (مثل الأسنان، البصريات، الحمل والولادة) <br>
                    بشكل مستقل لكل فئة تأمينية.
                </p>
            </div>

        </div>
    </div>
</div>
{% endblock %}